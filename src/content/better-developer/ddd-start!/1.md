# 1. 도메인 모델의 시작
#### 도메인
- 소프트웨어로 해결하고자 하는 문제 영역
- 하나의 도메인은 여러 하위 도메인으로 나뉠 수 있음
- 소프트웨어가 특정 도메인의 제공해야할 모든 기능을 구현해야하는건 아님 (e.g. 결제 도메인의 경우 주로 외부 결제 대행업체 활용)

#### 도메인 모델
- 특정 도메인을 개념적으로 표현한 것
- 도메인 모델은 도메인이 제공하는 기능과 주요 데이터 구성을 포함
- 도메인을 모델링하는데엔 객체, 상태 다이어그램, 수학 공식 등 어떠한 것이든 제약이 X. 모델링 결과를 모든 이해관계자가 이해하는 것이 중요
- 도메인 모델은 도메인 자체를 이해하기 위한 개념 모델임. 개발을 위해 구현 모델이 따로 필요

#### 도메인 모델 패턴
- 사용자 인터페이스(UI) or 표현(Presentation)
    - 사용자의 요청을 처리 및 결과를 보여줌
    - 사용자는 실제 유저뿐만 아니라 연동하는 외부 시스템이 될 수도 있음
- 응용 (Application)
    - 사용자가 요청한 기능을 실행
    - 업무 로직을 직접 구현하지 않고(!!) 도메인 계층에 구현된 규칙들을 조합해 실행함
- 도메인 (Domain)
    - 시스템이 제공할 도메인의 규칙을 구현
- 인프라스트럭처 (Infrastructure)
    - 데이터베이스, 메시징 시스템 등 외부 시스템과의 연동을 처리

#### 개념 모델 vs 구현 모델
- 개념 모델은 순수하게 문제를 분석한 결과물
- 개념 모델에는 데이터베이스, 트랜잭션 처리, 성능, 구현 기술에 대한 고려는 들어가지 않음
- 구현 모델은 개념 모델을 구현 가능한 모델로 전환한 것
- 개념 모델을 통해 전체적인 윤곽을 확인할 수 있는 개요 수준의 모델을 작성하고, 구현 과정에서 구현 모델로 점진적으로 발전

#### 도메인 모델 도출
- 기획서, Use Case 등의 요구사항을 바탕으로 도메인 모델을 도출
- 모델링 툴은 중요하지 않다.
- 도메인 모델을 구성하는 핵심 구성요소, 규칙, 기능을 찾는다.
- 문서화를 하고 문서를 관계자들이 공유하여 소프트웨어 전반을 이해하기 쉽도록 한다.

#### 엔티티와 밸류
- 도출한 도메인 모델은 크게 엔티티(Entity)와 밸류(Value)로 구분된다.

##### 엔티티(Entity)
- 엔티티의 가장 큰 특징은 식별자를 갖는다는 것 -> 엔티티 객체를 고유한 객체로 식별할 수 있도록해줌
- 엔티티 식별자는 엔티티 생성부터 삭제까지 유지됨
- 엔티티 식별자가 같은 두 개의 엔티티는 같은 엔티티라고 판단할 수 있고, 이를 기반으로 equals, hashCode 메소드를 아래와 같이 구현할 수 있음
```java
public class Entity {
    private String identifier;

    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null) return false;
        if (obj.getClass() != Entity.class) return false;
        Entity other = (Entity) obj;
        if (this.identifier == null) return false;
        return this.identifier.equals(other.identifier);
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((identifier == null) ? 0 : identifier.hashCode());
        return result;
    }
}
```

- 엔티티 식별자는 도메인의 특징 또는 구현 기술에 따라 생성 방식이 달라진다.
  - 특정 규칙에 따라 생성 (Timestamp 이용 등)
  - `8-4-4-4-12` 형태의 16진수 문자열 조합인 UUID 사용 (Java의 경우 `UUID` 클래스 활용)
```java
UUID uuid = UUID.randomUUID();

// 615f2ab9-c374-4b50-9420-2154594af151 과 같은 형태의 문자열 제공
String identifier = uuid.toString();
```
  - 값을 직접 입력 (회원 ID, 이메일 등)
  - 일련번호 사용 (오라클의 시퀀스 오브젝트, MySQL Auto Increment 컬럼 등)

##### 밸류(Value)
- 밸류 타입은 개념적으로 완전한 하나를 표현할 때 사용
- 예를들어 아래와 같은 배송정보가 있는 경우가 있다.
```java
public class ShippingInfo {
    // 받는 사람
    private String receiverName;
    private String receiverPhoneNumber;
    // 주소  
    private String shippingAddress1;  
    private String shippingAddress2;  
    private String shippingAddress3;  
}
```
- `receiverName`, `receiverPhoneNumber` 의 경우 서로 다른 정보를 표현하고 있지만, 개념적으로는 **받는 사람**이라는 하나의 정보를 표현하고 있으며 아래왁 같이 구현될 수 있다.
- `Receiver`라는 클래스로 밸류 타입을 구현하여 도메인 정보를 보다 더 잘 표현할 수 있다. 
```java
public class Receiver {
    private String name;
    private String phoneNumber;

    public Receiver(String name, String phoneNumber) {
        this.name = name;
        this.phoneNumber = phoneNumber;
    }

    public String getName() {
        return this.name;
    }

    public String getPhoneNumber() {
        return this.phoneNumber;
    }
}
```
- 마찬가지로 `shippingAddress1`, `shippingAddress2`, `shippingAddress3`도 마찬가지로 **주소**라는 하나의 정보를 표현하고 있다.
```java
public class Address {
    private String address1;
    private String address2;
    private String zipcode;

    public Address(String address1, String address2, String zipcode) {
        this.address1 = address1
        this.address2 = address2
        this.zipcode = zipcode
    }
}
```
- 밸류 타입을 활용해 `ShippingInfo`를 다시 구현하면 보다 더 객체지향적이고 명확하게 구현된다.
```java
public class ShippingInfo {
    private Receiver receiver;
    private Address address;

    ...
}
```
- 밸류타입은 꼭 여러 속성을 하나로 묶지 않더라도 의미를 명확하기 위해 사용하기도 한다.
- 아래 예시의 경우 `price`, `quantity`, `amounts` 각각 가격, 수량, 금액을 의미하는데 가격과 금액은 **돈**을 의미하는 값이다.
```java
public class OrderLine {
    private int price;
    private int quantity;
    private int amounts;
    ...
}
```
- 이를 Money라는 밸류를 만들어 사용하면 다음과 같이 표현할 수 있다.
```java
public class Money {
    private int value;

    public Money(int value) {
        this.value = value;        
    }

    public int getValue() {
        return this.value;
    }
}
// int 대신 Money 타입을 사용하여 도메인 속성이 의미하는 바를 보다 명확하게 표현
public class OrderLine {
    private Money price;
    private int quantity;
    private Money amounts;  
}
```
- 또한 이렇게 밸류를 추출하면 해당 밸류가 표현하는 도메인의 규칙 또는 기능을 추가로 구현할 수 있다.
- 이 밸류를 사용하면 구현한 코드에 도메인 모델의 의미를 더 잘 표현할 수 있게된다.
```java
public class Money {
    private int value;

    public Money(int value) {
        this.value = value;        
    }

    public int getValue() {
        return this.value;
    }

    public Money add(Money money) {
        return new Money(this.value + money.value);
    }

    public Money multiply(Money money) {
        return new Money(this.value * money.value);
    }    
}
```
```java
public class OrderLine {
    private Money price;
    private int quantity;
    private Money amounts;  

    public Money calculateAmounts() {
        // 코드가 돈 계산이라는 의미를 갖게됨
        return price.multiply(amounts);
    }
}
```
```java
public class OrderLine {
    private int price;
    private int quantity;
    private int amounts;  

    public int calculateAmounts() {
        // 코드에 돈 계산의 의미는 없고 단지 정수 타입 연산일 뿐
        return price * amounts;
    }
}
```